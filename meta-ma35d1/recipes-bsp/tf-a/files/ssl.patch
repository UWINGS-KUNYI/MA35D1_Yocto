From 0f6d90dd30bb757ea105697bfae7f9f354ad2f5b Mon Sep 17 00:00:00 2001
From: Kas User <kas@example.com>
Date: Thu, 17 Nov 2022 05:43:58 +0000
Subject: [PATCH] fiptool: respect OPENSSL_DIR

fiptool links to libcrypto, so as with the other tools it should respect
OPENSSL_DIR for include/library paths.

Upstream-Status: Submitted
Signed-off-by: Ross Burton <ross.burton@arm.com>
---
 Makefile               | 2 +-
 tools/fiptool/Makefile | 5 +++--
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/Makefile b/Makefile
index becbf0341..5762303bb 100644
--- a/Makefile
+++ b/Makefile
@@ -1238,7 +1238,7 @@ fwu_fip: ${BUILD_PLAT}/${FWU_FIP_NAME}
 
 .PHONY: ${FIPTOOL}
 ${FIPTOOL}:
-	${Q}${MAKE} CPPFLAGS="-DVERSION='\"${VERSION_STRING}\"'" --no-print-directory -C ${FIPTOOLPATH}
+	${Q}${MAKE} CPPFLAGS="-DVERSION='\"${VERSION_STRING}\"'" OPENSSL_DIR=${OPENSSL_DIR} --no-print-directory -C ${FIPTOOLPATH}
 
 sptool: ${SPTOOL}
 .PHONY: ${SPTOOL}
diff --git a/tools/fiptool/Makefile b/tools/fiptool/Makefile
index ef3501432..4363caf29 100644
--- a/tools/fiptool/Makefile
+++ b/tools/fiptool/Makefile
@@ -11,6 +11,7 @@ include ${MAKE_HELPERS_DIRECTORY}build_env.mk
 PROJECT := fiptool${BIN_EXT}
 OBJECTS := fiptool.o tbbr_config.o
 V ?= 0
+OPENSSL_DIR := /usr
 
 override CPPFLAGS += -D_GNU_SOURCE -D_XOPEN_SOURCE=700
 HOSTCCFLAGS := -Wall -Werror -pedantic -std=c99
@@ -19,7 +20,7 @@ ifeq (${DEBUG},1)
 else
   HOSTCCFLAGS += -O2
 endif
-LDLIBS := -lcrypto
+LDLIBS := -L${OPENSSL_DIR}/lib -lcrypto
 
 ifeq (${V},0)
   Q := @
@@ -27,7 +28,7 @@ else
   Q :=
 endif
 
-INCLUDE_PATHS := -I../../include/tools_share
+INCLUDE_PATHS := -I../../include/tools_share -I${OPENSSL_DIR}/include
 
 HOSTCC ?= gcc
 
-- 
2.30.2

